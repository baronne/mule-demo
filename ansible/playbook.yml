---
- name: Configure API Host
  hosts: all
  environment:
    MULE_HOME: '/opt/mule-enterprise-standalone-4.4.0'
  tasks:
    - name: Install OpenJDK 1.8
      yum:
        name: java-1.8.0-openjdk
        state: present
        update_cache: yes

    - name: Install MySQL client
      yum:
        name: mysql
        state: latest
        update_cache: yes
    
    - name: Download and extract Mule Enterprise Standalone
      ansible.builtin.unarchive:
        src: https://s3.amazonaws.com/new-mule-artifacts/mule-ee-distribution-standalone-4.4.0.zip
        dest: /opt
        remote_src: yes

    - name: Set MULE_HOME environment variable
      delegate_to: localhost
      copy:
        content: export MULE_HOME="/opt/mule-enterprise-standalone-4.4.0"
        dest: /etc/profile.d/mule_home.sh
  
    - name: Install NGINX
      yum: 
        name: nginx 
        state: installed
        update_cache: yes
    
    - name: Setting the http server page for nginx
      shell: echo "<h1>Hello World!</h1>" > /usr/share/nginx/html/index.html
    
    - name: Start NGINX
      service: 
        name: nginx 
        enabled: yes 
        state: started
  